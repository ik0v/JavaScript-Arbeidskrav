<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdventureLand - Final Boss Battle</title>
    <!-- Du trenger ikke gjøre noe med CSS-koden! -->
    <link rel="stylesheet" href="css-skal-ikke-roeres/index.css">
</head>
<body>

    <div id="container">     

        <!--
            Life bars 
            - For å endre på life bar må dere få tak i div etter id, for eksempel "nameless-knight-hp-div".                       
        -->
        <div class="life-bar-container knight-container">     
            <img src="images/knight-head.png">
            <div class="life-bar" id="nameless-knight-hp-div"></div><!-- hp (Health Points) til ridderen -->
        </div>

        <div class="life-bar-container julia-container">
            <img src="images/julia-head.png">
            <div class="life-bar" id="julia-the-archer-hp-div"></div><!-- hp (Health Points) til Julia -->
        </div>

        <div class="life-bar-container cat-container">
            <img src="images/cat-head.png" alt="">
            <div class="life-bar" id="the-cat-hp-div"></div><!-- hp (Health Points) til katten -->
        </div>

        <div class="life-bar-container big-boss-container">
            <img src="images/big-boss-head.png" alt="">
            <div class="life-bar" id="big-boss-hp-div"></div><!-- hp (Health Points) til Big boss -->
        </div>


        <!-- The knight -->
        <img id="nameless-knight" src="images/knight.png" alt="">
       
        <!-- Julia the archer -->
        <img id="julia-the-archer" src="images/julia-the-archer.png">

        <!-- The Cat -->
        <img id="the-cat" src="images/cat.png" alt="">

        <!-- William the healer -->
        <img id="william-the-healer" src="images/healer.png">

        <!-- Jack the lumberjack -->
        <img id="jack-the-lumberjack" src="images/lumberjack.png" alt="">

        <!-- The big evil boss -->
        <img id="big-boss" src="images/big-boss.png" alt="">

        <!-- Noen ganger dukker et monster opp her -->
        <img id="appearing-monster" src="" alt=" ">


    </div><!-- end container-->


    <!-- Her skrives det ut informasjon om hva brukeren gjør og hva som skjer. -->
    <div id="output-div">
        <p>Her skal det skrives ut hva som skjer underveis i spillet. </p>
    </div>


    <script>
        // Her kommer din kode. Du kan også evt. velge å ha JS-koden i ekstern fil.

        var statusTxt = document.getElementById("output-div");

        var namelessKnight = document.getElementById("nameless-knight");
        var julia = document.getElementById("julia-the-archer");
        var cat = document.getElementById("the-cat");
        var boss = document.getElementById("big-boss");
        
        var monster = document.getElementById("appearing-monster");
        
        var knightHpBar = document.getElementById("nameless-knight-hp-div");
        var juliaHpBar = document.getElementById("julia-the-archer-hp-div");
        var catHpBar = document.getElementById("the-cat-hp-div");
        var bossHpBar = document.getElementById("big-boss-hp-div");

        var bossHp = 300;

        var monsterNames = ["Slime", "Bat"];
        var summonedMonsters = [false, false];   // for å lagre info om slime (pos 0) eller bat (pos1) ble tilkalt.
        
        var heroeNames = ["NamelessKnight", "Julia the archer", "The Cat"];
        var heroeNamesCur = ["NamelessKnight", "Julia the archer", "The Cat"];
        var heroeHps = [200,200,200];   // lagrer hp til heltene i array. 
        var heroeHpBars = [knightHpBar, juliaHpBar, catHpBar];   // lagrer variabler som peker til helter hp bar i array 
        var heroImages = [namelessKnight, julia, cat];

        namelessKnight.onclick = function() {
            if(summonedMonsters[0] || summonedMonsters[1]) {
                heroAttackMonster(heroeNames[0]);
            } else {
                if(!summonMonster(heroeNames[0])) {
                    knightAttackBoss();
                }
            }
            setTimeout(function() {
                bossAttackBack();
            }, 200);
        }

        julia.onclick = function() {
            if(summonedMonsters[0] || summonedMonsters[1]) {
                heroAttackMonster(heroeNames[1]);
            } else {   
                if(!summonMonster(heroeNames[1])) {
                    juliaAttackBoss();
                }
            }
            setTimeout(function() {
                bossAttackBack();
            }, 200);
        }

        cat.onclick = function() {
            if(summonedMonsters[0] || summonedMonsters[1]) {
                heroAttackMonster(heroeNames[2]);
            } else {  
                if(!summonMonster(heroeNames[2])) {
                    catAttackBoss();
                }
            }
            setTimeout(function() {
                bossAttackBack();
            }, 200);
        }

        function knightAttackBoss() {
            var damage = Math.floor(Math.random() * 15) + 10;   
            bossHp -= damage;
            if(bossHp <= 0) {
                bossHp = 0;
                setTimeout(function() {
                    alert("Du vant!");
                }, 50);
            }
            bossHpBar.style.width = `${bossHp}px`;
            console.log(`BigBoss -> ${bossHp} hp`);
            describeAction(heroeNames[0], damage, "bigBoss");
        }

        function juliaAttackBoss() {
            var damage = Math.floor(Math.random() * 15) + 5;
            bossHp -= damage;
            if(bossHp <= 0) {
                statusTxt.innerHTML = `<p>Du nesten vant! Men ${heroeNames[2]} kan ikke drepe BigBoss. *tips - noen med øks?</p>`;
                bossHp += damage;
                return;
            }
            bossHpBar.style.width = `${bossHp}px`;
            console.log(`BigBoss -> ${bossHp} hp`);
            describeAction(heroeNames[1], damage, "bigBoss");
        }

        function catAttackBoss() {
            var damage = Math.floor(Math.random() * 26) + 3;
            bossHp -= damage;
            if(bossHp <= 0) {
                statusTxt.innerHTML = `<p>Du nesten vant! Men ${heroeNames[2]} kan ikke drepe BigBoss. *tips - noen med øks?</p>`;
                bossHp += damage;
                return;
            }   
            bossHpBar.style.width = `${bossHp}px`;
            console.log(`BigBoss -> ${bossHp} hp`);
            describeAction(heroeNames[2], damage, "bigBoss");
        }

        function summonMonster(attackerName) {
            var chance = Math.random().toFixed(2);
            console.log(`Sjansen for monster: ${chance}`);
            if (chance > 0.75) {
                var monsterName = getMonsterName();
                monster.src = `images/${monsterName.toLowerCase()}.png`;
                statusTxt.innerHTML = `<p>${attackerName} gikk til angrep på BigBoss, men! 
                                       monster ${monsterName} ble tilkalt for å hjelpe BigBoss</p>`
                return true;
            } else return false;
        }

        function getMonsterName() {
            var chance = Math.random()
            console.log(chance);
            if (chance > 0.5) {
                summonedMonsters[0] = true;
                return monsterNames[0];
            }
            else {
                summonedMonsters[1] = true;
                return monsterNames[1];
            }
        }

        function heroAttackMonster(hero) {
            if (summonedMonsters[0] && hero === heroeNames[2]) {
                statusTxt.innerHTML = `<p>${hero} angriper ${monsterNames[0]} og ${monsterNames[0]} forlater BigBoss</p>`;
                summonedMonsters[0] = false;
                monster.src = ``;
            } else if (summonedMonsters[1] && hero === heroeNames[1]) {
                statusTxt.innerHTML = `<p>${hero} angriper ${monsterNames[1]} og ${monsterNames[1]} forlater BigBoss</p>`;
                summonedMonsters[1] = false;
                monster.src = ``;
            } else {
                var monsterName = summonedMonsters[0] ? monsterNames[0] : monsterNames[1];
                statusTxt.innerHTML = `<p>${hero} kan ikke angripe ${monsterName}, prøv angrep med annen helt</p>`;
            }
        }

        function bossAttackBack() {
            var heroCount = heroeNamesCur.length;
            var j = Math.floor(Math.random() * heroCount); // Velger hvem av heltene Big boss skal angripe;
            var damage = Math.floor(Math.random() * 15) + 3; // Big boss dmg er fra 20 til 50 hp; `

            var i = 0;
            while(heroeNames[i] !== heroeNamesCur[j]) i++;
        
            heroeHps[i] -= damage;
            if(heroeHps[i] <= 0) {
                heroeHps[i] = 0;
                removeHero(i, j, damage);
            } else {
                describeAction("Big boss", damage, heroeNames[i]);
            }
            console.log(`${heroeNames[i]} -> ${heroeHps[i]} hp`);
            heroeHpBars[i].style.width = `${heroeHps[i]}px`;
        }

        function removeHero(i, j, damage) {
            statusTxt.innerHTML += `<p>Å nei! Helten ${heroeNames[i]} falt etter BigBoss gjorde ${damage} hp skade.</p>`; 
            heroImages[i].src = "";
            
            heroeNamesCur.splice(j,1);
            console.log(heroeNamesCur);
            if (heroeNamesCur.length < 1) {
                setTimeout(function() {
                    alert("Du tapte :/");
                }, 50);
            }
        }

        function describeAction(attacker, damage, target) {
            var action = `<p>${attacker} angriper ${target} og gjør ${damage} hp skade.</p>`;
            if (attacker === "Big boss") {
                statusTxt.innerHTML += action; // I boss tilfelle legger til teksten til eksisterende. 
            } else {
                statusTxt.innerHTML = action; // Nullstiller output fra forrige verdi.
            }
        }
        
    </script>
    
</body>
</html>